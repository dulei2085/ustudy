set names utf8;
create database if not exists dashboard character set utf8;

create table if not exists dashboard.users (
id INT NOT NULL AUTO_INCREMENT,
loginname varchar(32) NOT NULL,
fullname varchar(32) NOT NULL,
phone varchar(20) NOT NULL,
passwd varchar(32) NOT NULL,
ugroup ENUM ('管理员', '运营', '市场') NOT NULL,
ctime datetime DEFAULT NULL,
ll_time datetime DEFAULT NULL,
status ENUM ('正常', '锁定', '未激活'),
UNIQUE KEY (loginname),
PRIMARY KEY (id)
) ENGINE=InnoDB;

create table if not exists dashboard.roles (
role_name varchar(32) NOT NULL,
user_name varchar(32) NOT NULL,
INDEX(user_name,role_name),
PRIMARY KEY (role_name),
FOREIGN KEY (user_name)
    REFERENCES dashboard.users(loginname)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

create table if not exists dashboard.perms (
id INT NOT NULL AUTO_INCREMENT,
permissions varchar(64) NOT NULL,
role_name varchar(32) NOT NULL,
INDEX (role_name),
PRIMARY KEY (id),
FOREIGN KEY (role_name)
    REFERENCES dashboard.roles(role_name)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

create table if not exists dashboard.school (
id INT NOT NULL AUTO_INCREMENT,
school_id  VARCHAR(32) NOT NULL,
school_name VARCHAR(128) NOT NULL,
school_type ENUM('高中', '初中', '完中', '九年制', '小学', '十二年制', '补习', '其他') NOT NULL,
province  VARCHAR(32) NOT NULL,
city      VARCHAR(32) NOT NULL,
district  VARCHAR(32) NOT NULL,
PRIMARY KEY (id),
INDEX(school_name),
UNIQUE KEY (school_id)
) ENGINE=InnoDB;

create table if not exists dashboard.grade (
id INT NOT NULL AUTO_INCREMENT,
grade_name VARCHAR(32) NOT NULL,
classes_num INT NOT NULL,
school_id VARCHAR(32) NOT NULL,
PRIMARY KEY(id),
INDEX(school_id, grade_name),
FOREIGN KEY (school_id)
    REFERENCES dashboard.school(school_id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

create table if not exists dashboard.course (
id INT NOT NULL AUTO_INCREMENT,
grade_id INT NOT NULL,
course_name VARCHAR(32) NOT NULL,
PRIMARY KEY (id),
INDEX(grade_id),
FOREIGN KEY (grade_id)
    REFERENCES dashboard.grade(id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;
